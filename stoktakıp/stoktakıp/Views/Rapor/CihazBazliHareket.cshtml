@model IEnumerable<stoktakýp.Models.TeslimIslemi>

@{
    ViewData["Title"] = "Cihaz Bazlý Hareket Raporu";
    var cihazlar = ViewData["Cihazlar"] as List<stoktakýp.Models.Cihaz>;
}

<div class="row mb-3">
    <div class="col-12">
        <h2><i class="fas fa-list-alt"></i> Cihaz Bazlý Hareket Raporu</h2>
    </div>
</div>

<div class="card mb-3">
    <div class="card-body">
        <form asp-action="CihazBazliHareket" method="get" class="row g-3">
            <div class="col-md-10">
                <label class="form-label">Cihaz Seçin:</label>
                <select name="cihazId" class="form-select" required>
                    <option value="">-- Cihaz Seçin --</option>
                    @if (cihazlar != null)
                    {
                        @foreach (var cihaz in cihazlar)
                        {
                            <option value="@cihaz.CihazId" selected="@(ViewData["CihazId"]?.ToString() == cihaz.CihazId.ToString())">
                                @cihaz.CihazAdi - @cihaz.Marka @cihaz.Model (@cihaz.SeriNumarasi)
                            </option>
                        }
                    }
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search"></i> Görüntüle
                </button>
            </div>
        </form>
    </div>
</div>

@if (ViewData["CihazId"] != null)
{
    <div class="card">
        <div class="card-body">
            @if (Model.Any())
            {
                var cihaz = Model.First().Cihaz;

                <div class="alert alert-info mb-3">
                    <h5>Cihaz Bilgileri</h5>
                    <div class="row">
                        <div class="col-md-3"><strong>Cihaz:</strong> @cihaz.CihazAdi</div>
                        <div class="col-md-3"><strong>Marka/Model:</strong> @cihaz.Marka @cihaz.Model</div>
                        <div class="col-md-3"><strong>Seri No:</strong> @cihaz.SeriNumarasi</div>
                        <div class="col-md-3"><strong>Mevcut Stok:</strong> <span class="badge bg-success">@cihaz.MevcutStok</span></div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Tarih</th>
                                <th>Ýþlem Tipi</th>
                                <th>Teslim Eden</th>
                                <th>Teslim Alan</th>
                                <th>Adet</th>
                                <th>Ýade Tarihi</th>
                                <th>Durum</th>
                                <th>Açýklama</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.TeslimTarihi.ToString("dd.MM.yyyy")</td>
                                    <td>
                                        @if (item.IslemTipi == stoktakýp.Models.IslemTipi.StokGirisi)
                                        {
                                            <span class="badge bg-success"><i class="fas fa-arrow-down"></i> Stok Giriþi</span>
                                        }
                                        else if (item.IslemTipi == stoktakýp.Models.IslemTipi.PersoneleTeslim)
                                        {
                                            <span class="badge bg-warning text-dark"><i class="fas fa-arrow-up"></i> Personele Teslim</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-info"><i class="fas fa-undo"></i> Ýade</span>
                                        }
                                    </td>
                                    <td>@item.TeslimEden</td>
                                    <td>@item.TeslimAlan</td>
                                    <td><span class="badge bg-secondary">@item.Adet</span></td>
                                    <td>@(item.IadeTarihi?.ToString("dd.MM.yyyy") ?? "-")</td>
                                    <td>
                                        @if (item.IslemTipi == stoktakýp.Models.IslemTipi.PersoneleTeslim && !item.IadeTarihi.HasValue)
                                        {
                                            <span class="badge bg-warning text-dark">Zimmetli</span>
                                        }
                                        else if (item.IadeTarihi.HasValue)
                                        {
                                            <span class="badge bg-success">Ýade Edildi</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-info">Tamamlandý</span>
                                        }
                                    </td>
                                    <td><small>@(item.Aciklama ?? "-")</small></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-secondary mt-3">
                    <strong>Toplam Ýþlem Sayýsý:</strong> @Model.Count() |
                    <strong>Toplam Giriþ:</strong> @Model.Where(t => t.IslemTipi == stoktakýp.Models.IslemTipi.StokGirisi || t.IslemTipi == stoktakýp.Models.IslemTipi.Iade).Sum(t => t.Adet) adet |
                    <strong>Toplam Çýkýþ:</strong> @Model.Where(t => t.IslemTipi == stoktakýp.Models.IslemTipi.PersoneleTeslim).Sum(t => t.Adet) adet
                </div>
            }
            else
            {
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle"></i> Seçilen cihaza ait iþlem bulunmamaktadýr.
                </div>
            }
        </div>
    </div>
}

